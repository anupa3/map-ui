<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Map UI — Closest Stores</title>

  <style>
    :root{
      --bg: #0b1220;
      --card: rgba(255,255,255,0.08);
      --text: rgba(255,255,255,0.92);
      --muted: rgba(255,255,255,0.70);
      --border: rgba(255,255,255,0.14);
      --shadow: 0 12px 40px rgba(0,0,0,0.35);
      --radius: 18px;
      --radius2: 14px;
      --accent: #7c3aed;
      --ok: #22c55e;
      --bad: #ef4444;
      --warn: #f59e0b;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color: var(--text);
      background:
        radial-gradient(900px 500px at 20% 10%, rgba(124,58,237,0.35), transparent 60%),
        radial-gradient(800px 500px at 85% 20%, rgba(34,197,94,0.25), transparent 55%),
        radial-gradient(900px 600px at 60% 110%, rgba(59,130,246,0.20), transparent 55%),
        var(--bg);
      min-height:100vh;
      padding: 28px 14px;
    }
    .wrap{ max-width: 1050px; margin: 0 auto; }
    .header{ display:flex; justify-content:space-between; align-items:flex-start; gap:16px; margin-bottom:16px; }
    h1{ margin:0; font-size: clamp(1.4rem, 2.2vw, 2rem); letter-spacing:-0.02em; }
    .subtitle{ color: var(--muted); line-height:1.45; max-width: 70ch; margin-top:6px; }
    .badgeTop{
      display:inline-flex; align-items:center; gap:8px;
      padding: 8px 12px; border:1px solid var(--border); border-radius:999px;
      background: rgba(255,255,255,0.06); box-shadow: 0 6px 18px rgba(0,0,0,0.22);
      color: var(--muted); font-size: 0.9rem; white-space:nowrap;
    }
    .dot{ width:8px; height:8px; border-radius:50%; background: var(--ok); box-shadow: 0 0 0 4px rgba(34,197,94,0.16); }
    .panel{
      border: 1px solid var(--border);
      background: linear-gradient(180deg, var(--card), rgba(255,255,255,0.05));
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .panel-head{ padding: 16px 16px 0; }
    .panel-title{ font-weight:800; letter-spacing:-0.01em; margin:0 0 6px; }
    .panel-note{ color: var(--muted); margin:0; }
    .panel-body{ padding: 14px 16px 16px; }
    .row{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
    .field{
      flex:1; min-width: 280px;
      display:flex; align-items:center; gap:10px;
      padding: 12px 14px;
      border:1px solid var(--border);
      border-radius: 14px;
      background: rgba(0,0,0,0.18);
      backdrop-filter: blur(8px);
    }
    input{ width:100%; border:none; outline:none; background:transparent; color: var(--text); font-size:1rem; }
    input::placeholder{ color: rgba(255,255,255,0.55); }
    .btn{
      display:inline-flex; align-items:center; justify-content:center; gap:8px;
      padding: 12px 14px; border-radius: 14px;
      border:1px solid var(--border);
      cursor:pointer; font-weight:700; letter-spacing:-0.01em;
      transition: transform 120ms ease, background 120ms ease;
      user-select:none;
      background: rgba(255,255,255,0.06);
      color: var(--text);
    }
    .btn:active{ transform: translateY(1px); }
    .btnPrimary{
      background: linear-gradient(135deg, rgba(124,58,237,0.95), rgba(99,102,241,0.85));
      border-color: rgba(255,255,255,0.18);
    }
    .btnPrimary:hover{ background: linear-gradient(135deg, rgba(124,58,237,1), rgba(99,102,241,0.95)); }
    .status{
      margin-left:auto;
      display:inline-flex; align-items:center; gap:10px;
      padding: 10px 12px; border-radius:999px; border:1px solid var(--border);
      background: rgba(255,255,255,0.06); color: var(--muted); font-size:0.92rem;
    }
    .status.loading .dot{ background: var(--warn); box-shadow: 0 0 0 4px rgba(245,158,11,0.16); }
    .status.error .dot{ background: var(--bad); box-shadow: 0 0 0 4px rgba(239,68,68,0.16); }

    .contentGrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
      padding: 14px 16px 18px;
      border-top: 1px solid var(--border);
      background: linear-gradient(180deg, rgba(255,255,255,0.05), rgba(255,255,255,0.03));
    }
    @media (max-width: 900px){
      .contentGrid{ grid-template-columns: 1fr; }
      .status{ margin-left:0; }
    }

    .mapWrap{
      border: 1px solid rgba(255,255,255,0.14);
      border-radius: var(--radius2);
      overflow:hidden;
      background: rgba(0,0,0,0.18);
      min-height: 380px;
    }
    #map{ width:100%; height: 380px; }

    .resultsWrap{ }
    .resultHead{ display:flex; justify-content:space-between; align-items:baseline; gap:10px; margin-bottom:8px; }
    .small{ color: var(--muted); font-size:0.92rem; }

    .card{
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(0,0,0,0.18);
      border-radius: var(--radius2);
      padding: 12px;
      margin: 10px 0;
      display:flex;
      flex-direction:column;
      gap: 6px;
    }
    .cardTop{ display:flex; justify-content:space-between; gap:10px; align-items:center; }
    .storeName{ font-weight: 850; letter-spacing:-0.01em; }
    .dist{ font-variant-numeric: tabular-nums; color: rgba(255,255,255,0.85); }
    .addr{ color: var(--muted); }

    .pill{
      display:inline-flex; align-items:center; gap:6px;
      padding: 4px 10px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,0.16);
      font-size: 0.85rem;
      color: rgba(255,255,255,0.88);
      white-space:nowrap;
    }
    .pill.open{ background: rgba(34,197,94,0.18); border-color: rgba(34,197,94,0.35); }
    .pill.closed{ background: rgba(239,68,68,0.18); border-color: rgba(239,68,68,0.35); }
    footer{ margin-top: 14px; text-align:center; color: rgba(255,255,255,0.55); font-size:0.9rem; }
  </style>
</head>

<body>
<div class="wrap">

  <div class="header">
    <div>
      <h1>Closest Store Finder</h1>
      <div class="subtitle">
        Enter a full address → convert to <b>lat/lng</b> → rank stores by distance → show top 10.
        Includes <b>Open/Closed</b> badges and a mini map preview.
      </div>
    </div>
    <div class="badgeTop">
      <span class="dot"></span>
      <span id="headerStatus">Booting…</span>
    </div>
  </div>

  <div class="panel">
    <div class="panel-head">
      <div class="panel-title">Search</div>
      <p class="panel-note">Example: <b>65-30 Kissena Blvd, Queens, NY 11367</b></p>
    </div>

    <div class="panel-body">
      <div class="row">
        <div class="field">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M12 22s7-5.4 7-12a7 7 0 1 0-14 0c0 6.6 7 12 7 12Z" stroke="white" opacity="0.8" stroke-width="1.6"/>
            <path d="M12 13.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7Z" stroke="white" opacity="0.8" stroke-width="1.6"/>
          </svg>
          <input id="address" placeholder="Enter full address..." />
        </div>

        <button class="btn btnPrimary" id="addrBtn">Search</button>
        <button class="btn" id="clearBtn">Clear</button>

        <div class="status loading" id="status">
          <span class="dot"></span>
          <span id="statusText">Loading Google…</span>
        </div>
      </div>
    </div>

    <div class="contentGrid">
      <div class="mapWrap">
        <div id="map"></div>
      </div>

      <div class="resultsWrap">
        <div class="resultHead">
          <b>Results</b>
          <span class="small" id="resultMeta">No search yet.</span>
        </div>
        <div id="results"></div>
      </div>
    </div>
  </div>

  <footer>Dummy stores + hours for demo. Swap stores with DB/API later.</footer>
</div>

<script>
  // ------------------ Dummy stores (add hours for Open/Closed) ------------------
  // hours: open & close in 24h local time (e.g., 9 to 21 = 9AM–9PM)
  const stores = [
    { id: 1,  name: "Queens Mini Mart",     lat: 40.7349, lon: -73.8150, address: "Main St, Queens, NY",      open: 8,  close: 22 },
    { id: 2,  name: "Fresh Corner Grocery", lat: 40.7412, lon: -73.8209, address: "Kissena Blvd, Queens, NY", open: 7,  close: 23 },
    { id: 3,  name: "Astoria Market",       lat: 40.7644, lon: -73.9235, address: "30th Ave, Queens, NY",     open: 9,  close: 21 },
    { id: 4,  name: "LIC Pharmacy",         lat: 40.7447, lon: -73.9488, address: "Jackson Ave, Queens, NY",  open: 10, close: 19 },
    { id: 5,  name: "Manhattan QuickStop",  lat: 40.7510, lon: -73.9900, address: "8th Ave, New York, NY",    open: 0,  close: 24 }, // 24/7
    { id: 6,  name: "SoHo Convenience",     lat: 40.7240, lon: -74.0000, address: "Prince St, New York, NY",  open: 9,  close: 22 },
    { id: 7,  name: "Brooklyn General",     lat: 40.6932, lon: -73.9890, address: "Court St, Brooklyn, NY",   open: 8,  close: 20 },
    { id: 8,  name: "DUMBO Pantry",         lat: 40.7033, lon: -73.9896, address: "Water St, Brooklyn, NY",   open: 11, close: 23 },
    { id: 9,  name: "Bronx Essentials",     lat: 40.8205, lon: -73.9130, address: "Grand Concourse, Bronx, NY",open: 8, close: 18 },
    { id:10,  name: "Harlem Food Hub",      lat: 40.8116, lon: -73.9465, address: "Lenox Ave, New York, NY",  open: 9,  close: 21 },
    { id:11,  name: "Flushing Supplies",    lat: 40.7590, lon: -73.8300, address: "Roosevelt Ave, Queens, NY",open: 10, close: 20 },
    { id:12,  name: "Jamaica Value Store",  lat: 40.7027, lon: -73.7890, address: "Jamaica Ave, Queens, NY",  open: 9,  close: 22 },
  ];

  // ------------------ Haversine distance (miles) ------------------
  function haversineMiles(lat1, lon1, lat2, lon2) {
    const R = 3958.8;
    const toRad = d => d * Math.PI / 180;
    const dLat = toRad(lat2 - lat1);
    const dLon = toRad(lon2 - lon1);
    const a = Math.sin(dLat/2)**2 +
      Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) *
      Math.sin(dLon/2)**2;
    return 2 * R * Math.asin(Math.sqrt(a));
  }

  // Open/Closed logic (simple demo)
  function isOpenNow(store, now = new Date()) {
    const h = now.getHours();
    if (store.open === 0 && store.close === 24) return true;   // 24/7
    // handle overnight hours like 20->4
    if (store.close < store.open) return (h >= store.open || h < store.close);
    return (h >= store.open && h < store.close);
  }

  function hoursLabel(store) {
    if (store.open === 0 && store.close === 24) return "24/7";
    return `${store.open}:00–${store.close}:00`;
  }

  const headerStatus = document.getElementById("headerStatus");
  const statusEl = document.getElementById("status");
  const statusText = document.getElementById("statusText");
  const resultsEl = document.getElementById("results");
  const resultMeta = document.getElementById("resultMeta");
  const addressEl = document.getElementById("address");

  function setStatus(mode, text){
    statusEl.classList.remove("loading","error");
    if (mode === "loading") statusEl.classList.add("loading");
    if (mode === "error") statusEl.classList.add("error");
    statusText.textContent = text;
    headerStatus.textContent = text;
  }

  // ------------------ Google Map + Markers ------------------
  let map = null;
  let geocoder = null;
  let userMarker = null;
  let storeMarkers = [];

  function clearStoreMarkers() {
    storeMarkers.forEach(m => m.setMap(null));
    storeMarkers = [];
  }

  function fitToMarkers(markers) {
    if (!map || !markers.length) return;
    const bounds = new google.maps.LatLngBounds();
    markers.forEach(m => bounds.extend(m.getPosition()));
    map.fitBounds(bounds);
  }

  function renderOnMap(userLatLng, rankedStores) {
    if (!map) return;

    // User marker
    if (userMarker) userMarker.setMap(null);
    userMarker = new google.maps.Marker({
      position: userLatLng,
      map,
      title: "Search location",
      label: { text: "You", color: "white" }
    });

    // Store markers (top 10)
    clearStoreMarkers();
    rankedStores.forEach((s, idx) => {
      const marker = new google.maps.Marker({
        position: { lat: s.lat, lng: s.lon },
        map,
        title: s.name,
        label: { text: String(idx + 1), color: "white" }
      });

      const openNow = isOpenNow(s);
      const info = new google.maps.InfoWindow({
        content: `
          <div style="font-family:Arial; max-width:220px;">
            <b>${s.name}</b><br/>
            <span>${s.address}</span><br/>
            <span><b>${s.dist.toFixed(2)} mi</b></span><br/>
            <span style="color:${openNow ? "#22c55e" : "#ef4444"}; font-weight:700;">
              ${openNow ? "OPEN" : "CLOSED"}
            </span>
            <span style="color:#666;"> (${hoursLabel(s)})</span>
          </div>
        `
      });

      marker.addListener("click", () => info.open({ anchor: marker, map }));
      storeMarkers.push(marker);
    });

    fitToMarkers([userMarker, ...storeMarkers]);
  }

  // ------------------ Results rendering ------------------
  function renderResults(centerLat, centerLon, addrLabel) {
    const ranked = stores
      .map(s => ({ ...s, dist: haversineMiles(centerLat, centerLon, s.lat, s.lon) }))
      .sort((a,b) => a.dist - b.dist)
      .slice(0, 10);

    resultMeta.textContent = `Top 10 near: ${addrLabel}`;

    resultsEl.innerHTML = ranked.map(s => {
      const openNow = isOpenNow(s);
      return `
        <div class="card">
          <div class="cardTop">
            <span class="storeName">${s.name}</span>
            <span class="dist">${s.dist.toFixed(2)} mi</span>
          </div>
          <div class="addr">${s.address}</div>
          <div>
            <span class="pill ${openNow ? "open" : "closed"}">
              ${openNow ? "OPEN" : "CLOSED"}
            </span>
            <span style="color: var(--muted); font-size:0.92rem; margin-left:8px;">
              Hours: ${hoursLabel(s)}
            </span>
          </div>
        </div>
      `;
    }).join("");

    renderOnMap({ lat: centerLat, lng: centerLon }, ranked);
  }

  function clearAll(){
    addressEl.value = "";
    resultsEl.innerHTML = "";
    resultMeta.textContent = "No search yet.";
    if (userMarker) userMarker.setMap(null);
    clearStoreMarkers();
    if (map) map.setCenter({ lat: 40.7365, lng: -73.8196 }); // Queens-ish
    if (map) map.setZoom(11);
    setStatus("loading", "Ready");
  }

  // ------------------ Google init + geocoding ------------------
  function initGoogle(){
    geocoder = new google.maps.Geocoder();

    // Create map
    map = new google.maps.Map(document.getElementById("map"), {
      center: { lat: 40.7365, lng: -73.8196 },
      zoom: 11,
      mapTypeControl: false,
      streetViewControl: false,
      fullscreenControl: false
    });

    setStatus("loading", "Ready");
  }
  window.initGoogle = initGoogle;

  function geocodeAddress(){
    const addr = addressEl.value.trim();
    if (!addr) { setStatus("error","Type an address"); return; }
    if (!geocoder) { setStatus("error","Google not loaded"); return; }

    setStatus("loading","Geocoding…");

    geocoder.geocode({ address: addr }, (results, status) => {
      if (status !== "OK" || !results || !results.length) {
        setStatus("error", "Geocode failed: " + status);
        return;
      }
      const loc = results[0].geometry.location;
      renderResults(loc.lat(), loc.lng(), addr);
      setStatus("loading","Ready");
    });
  }

  document.getElementById("addrBtn").addEventListener("click", geocodeAddress);
  document.getElementById("clearBtn").addEventListener("click", clearAll);
  addressEl.addEventListener("keydown", (e)=>{ if(e.key==="Enter") geocodeAddress(); });

  // initial
  setStatus("loading","Loading Google…");
</script>

<!-- Replace YOUR_KEY_HERE with your Google API key (preferably rotated + restricted) -->
<script async defer
  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDgcQyHeXwmdA_MR8GR04I2VGCpW9RaZ9c&callback=initGoogle">
</script>

</body>
</html>
